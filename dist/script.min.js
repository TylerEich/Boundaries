/*
 Boundaries v1.0.0
 (c) 2013-2014 Tyler Eich https://github.com/TylerEich/Boundaries
 License: MIT
*/
angular.module("bndry.action",[]).controller("ActionCtrl",["$rootScope","$scope","HistorySvc",function(e,n,o){n.clear=function(){e.$broadcast("action:clear"),o.clear()},n.undo=function(){o.hasUndo()&&o.undo()},n.redo=function(){o.hasRedo()&&o.redo()}}]),angular.module("bndry.color",["ngStorage"]).service("ColorSvc",["$localStorage",function(e){function n(e,n,o,r){return e=Math.round(255*e),n=Math.round(255*n),o=Math.round(255*o),r=Math.round(255*r),(e<<24|n<<16|o<<8|r)>>>0}function o(e,n,o){return 0>o&&(o+=1),o>1&&(o-=1),1/6>o?e+6*(n-e)*o:.5>o?n:2/3>o?e+(n-e)*(2/3-o)*6:e}var r={},t=this;this.convert={rgba:function(e){return r=n(e.r,e.g,e.b,e.a),t},hsla:function(e){var a,i,l,c=e.h,s=e.s,u=e.l,d=e.a;if(0==s)a=i=l=u;else{var g=.5>u?u*(1+s):u+s-u*s,f=2*u-g;a=o(f,g,c+1/3),i=o(f,g,c),l=o(f,g,c-1/3)}return r=n(a,i,l,d),t},hex24:function(e){return t.convert.hex32(e+"FF"),t},hex32:function(e){return r=parseInt(e,16)>>>0,t}},this.to={rgba:function(){var e=(r>>24&255)/255,n=(r>>16&255)/255,o=(r>>8&255)/255,t=(255&r)/255;return r=0,{r:e,g:n,b:o,a:t}},hsla:function(){var e,n,o=t.to.rgba(),r=o.r,a=o.g,i=o.b,l=o.a,c=Math.max(r,a,i),s=Math.min(r,a,i),u=(c+s)/2;if(c===s)e=n=0;else{var d=c-s;switch(n=u>.5?d/(2-c-s):d/(c+s),c){case r:e=(a-i)/d+(i>a?6:0);break;case a:e=(i-r)/d+2;break;case i:e=(r-a)/d+4}e/=6}return{h:e,s:n,l:u,a:l}},hex24:function(){return t.to.hex32().substring(0,6)},hex32:function(){var e=r.toString(16);return r=0,("00000000"+e).slice(-8)}},delete e.colors,e.$default({colors:[{name:"Red",label:"Do not work either side",r:1,g:0,b:0,a:.125,weight:10},{name:"Green",label:"Work ONLY the inner side",r:0,g:1,b:0,a:.125,weight:10},{name:"Blue",label:"Work both sides",r:0,g:0,b:1,a:.125,weight:10}],activeColorIndex:1}),t.colors=e.colors,t.activeColorIndex=function(){return e.activeColorIndex},t.setActiveColorIndex=function(n){e.activeColorIndex=n},t.activeColor=function(){return t.colors[t.activeColorIndex()]}}]).controller("ColorCtrl",["$scope","$localStorage","ColorSvc",function(e,n,o){e.$storage=n,e.fillColor=function(e){void 0===e&&(e=o.activeColorIndex);var n=o.colors[e];return"#"+o.convert.rgba(n).to.hex24()},e.activeColorIndex=o.activeColorIndex,e.setActiveColorIndex=o.setActiveColorIndex}]),angular.module("bndry.drawing",["ngStorage","bndry.map","bndry.color","bndry.shape","bndry.history"]).service("DirectionsSvc",["$rootScope","$q","MapSvc",function(e,n,o){var r=this,t=new o.DirectionsService;r.route=function(r){function a(n,r){t.route(r,function(r,t,i){if(i===o.DirectionsStatus.OK){var c=t.routes[0].overview_path;l.resolve(c)}else i===o.DirectionsStatus.UNKNOWN_ERROR&&3>n?(n++,a(n)):(e.$broadcast("load:error"),l.reject([r.origin,r.destination]))}.bind(null,r),function(o){3>n?(n++,a(n,o)):(e.$broadcast("load:error"),l.reject())}.bind(null,r))}if(2!==r.length)return console.error("Requires exactly 2 locations."),!1;var i={origin:r[0],destination:r[1],travelMode:o.TravelMode.DRIVING},l=n.defer();return a(0,i),e.$broadcast("load:start"),l.promise.then(function(n){return e.$broadcast("load:done"),n})}}]).service("DrawingSvc",["$rootScope","$q","$localStorage","DirectionsSvc","MapSvc","ColorSvc","ShapeSvc",function(e,n,o,r,t,a,i){function l(e,n,o,r){void 0===r&&(r=[]),void 0===o&&(o=0),void 0===n&&(n=0);var t=[n,o].concat(r);return Array.prototype.splice.apply(e,t)}function c(e,n){for(var o in n)n.hasOwnProperty(o)&&(e[o]=n[o])}function s(e){return Array.isArray(e)?e:[e]}function u(e){return console.assert("lat"in e&&"lng"in e&&"number"==typeof e.lat&&"number"==typeof e.lat,"latLng is not formatted properly"),new t.LatLng(e.lat,e.lng)}function d(e,n,o){return l(e,n,0,o)}function g(e,n,o){return l(e,n,o)}function f(e,o){void 0===o&&(o=!1),console.assert(Array.isArray(e),"locations is not an Array");for(var t=[],a=0;a<e.length-1;a++){var i,l=e[a],c=e[a+1];i=o?n.when(l.equals(c)?[l]:[l,c]):r.route([l,c]).catch(function(e,o){return n.when(e.equals(o)?[e]:[e,o])}.bind(null,l,c)),t.push(i)}return n.all(t)}function p(e,n,o){o=s(o);for(var r,a=o[Symbol.iterator]();!(r=a.next()).done;){var i=r.value;i._marker.setMap(t.map)}return l(e,n,0,o)}function v(e,n,o){void 0===o&&(o=1);for(var r,t=l(e,n,o),a=t[Symbol.iterator]();!(r=a.next()).done;){var i=r.value;i._marker.setMap(null)}return t}function h(e,n){console.assert("object"==typeof e&&"object"==typeof n,"Invalid parameters"),c(e,n);for(var o in n)switch(o){case"lat":case"lng":e._marker.setPosition(u(e))}}function m(e,n,o){var r=s(e),t=0,a=0;if(Array.isArray(o))for(a=0;a+n<r.length&&a<o.length;a++)t+=o[a],r[n+a].index+=t;else t=o;for(a+=n;a<r.length;a++)r[a].index+=t}function y(e,n,o){for(var r=s(e),t=n;t<r.length;t++)r[t].index=o}function b(e,n,o){var r=e[n-1],t=0;r&&(t=r.index),y(o,0,t)}function w(e,n,o){var r={start:null,end:null,length:null,nodeStart:null,nodeEnd:null,nodeLength:null,lastNode:!1,firstNode:!1},t=e.slice(n,o),a=t[0],i=t[t.length-1],l=e[n-1],c=e[o];return l||(r.firstNode=!0),l&&null!==l.index?(r.start=l.index,r.nodeStart=n):a&&null!==a.index?(r.start=a.index,r.nodeStart=n+1):(r.start=0,r.nodeStart=0),c||(r.lastNode=!0),c&&null!==c.index?(r.end=c.index,r.nodeEnd=o):i&&null!==i.index?(r.end=i.index,r.nodeEnd=o-1):(r.end=r.start,r.nodeEnd=r.nodeStart),r.nodeLength=r.nodeEnd-r.nodeStart,r.length=r.end-r.start,r}function S(e,n,o,r){var t,a=[],i=e.slice(n,o),l=e[n-1],c=e[o];l&&a.push(u(l));for(var s,d=i[Symbol.iterator]();!(s=d.next()).done;){var t=s.value;a.push(u(t))}return c&&a.push(u(c)),a.length<2&&a.push(a[0]),f(a,r)}function x(e,n){for(var o,r,t=n[Symbol.iterator]();!(r=t.next()).done;){var a=r.value;o=e[a.index],console.assert(o,"latLng is not defined"),h(a,{lat:o.lat(),lng:o.lng()})}}function C(n,o,r){var t=w(n.nodes,o,o+r);if(0!==r||!t.firstNode||t.lastNode){var a=n._poly.getPath().getArray(),i=t.length;t.lastNode&&i++,g(a,t.start,i),m(n.nodes,t.nodeStart,-t.length);var l=v(n.nodes,o,r);return n._poly.setPath(a),e.$broadcast("drawing:change"),l}}function $(n,o,r,t){for(var a,i,l,c=n._poly.getPath().getArray(),s=n.nodes,u=[],g=w(s,o,o+r.length),f=g.start,p=t[Symbol.iterator]();!(l=p.next()).done;){var a=l.value;i=a.pop(),d(c,f,a),f+=a.length,u.push(a.length)}var v=t.length;m(s,g.nodeStart,u),g.lastNode&&i&&(c.push(i),v++);var h=s.slice(o,o+v);return x(c,h),n._poly.setPath(c),e.$broadcast("drawing:change"),c}function D(e,o,r,t,a){return void 0===a&&(a=null),void 0===t&&(t=[]),T(function(e,o,r,t,a){var i=C(e,o,r);t=null===t?i:s(t),b(e.nodes,o,t),p(e.nodes,o,t);var l;return l=a?n.when(a):S.bind(null,e.nodes,o,o+t.length,e.rigid)(),l.then(function(e,n,o,r,t){return $(e,n,r,t)}.bind(null,e,o,r,t))}.bind(null,e,o,r,t,a))}function T(e){void 0===e&&(e=[]),console.assert(void 0!==e,"steps cannot be undefined"),e=s(e);for(var n,o=e[Symbol.iterator]();!(n=o.next()).done;){var r=n.value;U=U.then(r)}return U}function k(e,n,o){void 0===o&&(o=!1);var r;return r=o?new t.Polygon(E(e,o)):new t.Polyline(E(e,o)),{colorIndex:e,rigid:n,fill:o,_poly:r,nodes:[]}}function I(e,n,o){return T(l.bind(null,e,n,0,o))}function N(e,n,o){return T(function(e,n,o){for(var r=l(e,n,o),t=0;t<r.length;t++){var a=r[t];_(a,0,a.nodes.length),a._poly.setMap(null)}}.bind(null,e,n,o))}function M(e,n,o){void 0===o&&(o=null);var r=new t.Marker(L(e,n));return{lat:n.lat(),lng:n.lng(),index:o,_marker:r}}function A(e,n,o,r){return void 0===r&&(r=null),void 0===o&&(o=[]),D(e,n,0,o,r)}function _(e,n,o,r){return void 0===r&&(r=null),D(e,n,o,[],r)}function O(e,n,o,r){return void 0===r&&(r=null),T(function(e,n,o){h(e.nodes[n],o)}.bind(null,e,n,o)),D.bind(null,e,n,1,null,r)()}function P(e,n){var o=a.colors[e],r={path:t.SymbolPath.CIRCLE,scale:10,strokeColor:"#"+a.convert.rgba(o).to.hex24(),strokeOpacity:1,strokeWeight:2.5};return c(r,n),r}function L(e,n,o){var r={clickable:!0,crossOnDrag:!1,cursor:"pointer",draggable:!0,flat:!0,icon:P(e),map:t.map,position:n};return c(r,o),r}function E(e,n){var o={clickable:!n,draggable:!1,editable:!1,map:t.map},r=angular.copy(a.colors[e]);return r.a=.5,n?(o.fillColor=F(r),o.fillOpacity=1,o.strokeWeight=0):(o.strokeColor=F(r),o.strokeWeight=r.weight),o}function R(e){var n={type:"FeatureCollection"};return n.features=e.map(function(e){var n={type:"Feature"},o=e._poly.getPath().getArray(),r=o.map(function(e){return[e.lng(),e.lat()]});n.geometry={type:e.fill?"Polygon":"LineString",coordinates:e.fill?[r]:r};var t=e.colorIndex,a=e.rigid,i=e.fill,l=e.nodes;return n.properties={colorIndex:t,rigid:a,fill:i},n.properties.nodes=l.map(function(e){var n=e.lat,o=e.lng,r=e.index;return{lat:n,lng:o,index:r}}),n}),JSON.stringify(n)}function j(e){console.assert("string"==typeof e,"geoJson must be a string");var n=[],o=JSON.parse(e),n=o.features.map(function(e,o){var r=e.properties.colorIndex,a=e.properties.rigid,i=e.properties.fill,l=e.properties.nodes,c=k(r,a,i);I(n,o,c);var s,u=l.map(function(e){var n=new t.LatLng(e.lat,e.lng);return M.bind(null,c.colorIndex,n,e.index)()});s=i?e.geometry.coordinates[0]:e.geometry.coordinates;for(var d=s.map(function(e){return new t.LatLng(e[1],e[0])}),g=[],o=0;o<u.length-1;o++){var f=u[o],p=u[o+1],v=d.slice(f.index,p.index+1);g.push(v)}return console.log(g),A.bind(null,c,0,u,g)(),c});return n}function F(e){return"rgba("+Math.round(255*e.r)+","+Math.round(255*e.g)+","+Math.round(255*e.b)+","+e.a+")"}function q(e,n){var o=a.colors[e];G.setOptions(L(e,u(n),{clickable:!1,draggable:!1,icon:P(e,{scale:20,strokeWeight:2,strokeOpacity:.5,fillColor:"#"+a.convert.rgba(o).to.hex24(),fillOpacity:.125})}))}function z(){G.setMap(null)}var J=this,U=n.when();J.queue=T,J.makeDrawing=k,J.addDrawings=J.addDrawing=I,J.removeDrawings=J.removeDrawing=N,J.makeNode=M,J.addNodesToDrawing=J.addNodeToDrawing=A,J.removeNodesFromDrawing=J.removeNodeFromDrawing=_,J.changeNodeOfDrawing=O,J.drawingsToGeoJson=R,J.geoJsonToDrawings=j;var G=new t.Marker;J.showActiveNode=q,J.hideActiveNode=z,J.forceCreateNewDrawing=!1,J.shouldCreateNewDrawing=function(){if(0===J.drawings.length||J.forceCreateNewDrawing)return!0;var e=J.drawings[J.drawings.length-1],n=e&&(e.colorIndex!==a.activeColorIndex()||e.rigid!==i.rigid()||e.fill!==i.fill());return n},J.drawings,J.activeDrawingIndex=-1}]).controller("DrawingCtrl",["$scope","$localStorage","$timeout","DrawingSvc","ColorSvc","ShapeSvc","HistorySvc",function(e,n,o,r,t,a,i){function l(e){return"number"!=typeof e?r.activeDrawingIndex:void(r.activeDrawingIndex=e)}function c(e,n){var o=t.activeColorIndex(),c=a.rigid(),s=a.fill(),u=r.shouldCreateNewDrawing();if(u){var g=r.makeDrawing(o,c,s);l(l()+1),r.addDrawing(d,l(),g),r.forceCreateNewDrawing=!1}v(function(e,n,o,t){var a=d[e],c=r.makeNode(n,o),s=a.nodes.length;r.addNodeToDrawing(a,s,c),i.add({undo:function(e,n,o,t,a){r.removeNodeFromDrawing(n,t,1),a&&(r.removeDrawing(e,o,1),l(o-1))}.bind(null,d,a,e,s,t),redo:function(e,n,o,t,a,i){i&&(r.addDrawing(e,o,n),l(o+1)),r.addNodeToDrawing(n,t,a)}.bind(null,d,a,e,s,c,t)})}.bind(null,l(),o,n.latLng,u))}function s(e,n,o){var t=e[0],a=d[n],l=t.latLng;v(function(e,n,o){var t=e.nodes[n],a={lat:t.lat,lng:t.lng},l={lat:o.lat(),lng:o.lng()};r.changeNodeOfDrawing(e,n,l),i.add({undo:function(e,n,o){r.changeNodeOfDrawing(e,n,o)}.bind(null,e,n,a),redo:function(e,n,o){r.changeNodeOfDrawing(e,n,o)}.bind(null,e,n,l)})}.bind(null,a,o,l))}e.$storage=n.$default({drawings:[],rigid:!1,colors:[{r:1,g:0,b:0,a:.125,weight:10},{r:0,g:1,b:0,a:.125,weight:10},{r:0,g:0,b:1,a:.125,weight:10}]});for(var u,d=e.drawings=r.drawings=[],g=r.geoJsonToDrawings(localStorage.geoJson||r.drawingsToGeoJson(d)),f=g[Symbol.iterator]();!(u=f.next()).done;){var p=u.value;d.push(p)}l(d.length-1);var v=r.queue;e.$on("map:click",c),e.$on("action:clear",function(){r.removeDrawings(d,0,d.length),l(-1)}),e.$on("drawing:change",function(){if(localStorage.geoJson=r.drawingsToGeoJson(d),d.length>0&&d[d.length-1].nodes.length>0){var e=d[d.length-1].nodes,n=e[e.length-1];r.showActiveNode(t.activeColorIndex(),n)}else r.hideActiveNode()}),e.marker={click:function(e){c(void 0,e[0])},dragend:s},e.poly={click:function(e){c(void 0,e[0])}}}]),angular.module("bndry.geo",["bndry.map"]).service("GeolocationSvc",["$q",function(e){this.getLocation=function(){var n=e.defer();return"geolocation"in navigator?navigator.geolocation.getCurrentPosition(function(e){n.resolve(e)},function(e){n.reject(e)}):n.reject(!1),n.promise}}]).service("GeocodeSvc",["$q","MapSvc",function(e,n){this.geocode=function(o,r){var t=new n.Geocoder,a=e.defer(),i={};return r?i.bounds=o:i.location=o,t.geocode(i,function(e,o){o===n.GeocoderStatus.OK?a.resolve(e):a.reject(o)}),a.promise}}]),angular.module("bndry.history",[]).service("HistorySvc",function(){"use strict";var e,n,o=[],r=-1,t=!1;return n=function(e,n){return e&&"function"==typeof e[n]?(t=!0,e[n](),t=!1,this):this},{add:function(n){return t?this:(o.splice(r+1,o.length-r),o.push(n),r=o.length-1,e&&e(),this)},setCallback:function(n){e=n},undo:function(){var t=o[r];return t?(n(t,"undo"),r-=1,e&&e(),this):this},redo:function(){var t=o[r+1];return t?(n(t,"redo"),r+=1,e&&e(),this):this},clear:function(){var n=o.length;o=[],r=-1,e&&n>0&&e()},hasUndo:function(){return-1!==r},hasRedo:function(){return r<o.length-1},getCommands:function(){return o}}}),angular.module("bndry.image",["ngStorage","bndry.map","bndry.drawing","bndry.color"]).service("ImageSvc",["$http","$document","$localStorage","MapSvc","DrawingSvc","ColorSvc",function(e,n,o,r,t,a){var i=this;i.pxSize=function(e,n){var o=.7;return{ratio:o,width:o>=1?e:Math.round(o*e),height:1>o?n:Math.round(1/o*n)}},i.generateUrl=function(){if(t.drawings){var e,n,l,c,s,u,d,g="https://maps.googleapis.com/maps/api/staticmap",f=[],p=i.pxSize(640,640);for(e=0;e<o.style.length;e++){l=o.style[e],c=[],"featureType"in l&&"all"!==l.featureType&&c.push("feature:"+l.featureType),"elementType"in l&&"all"!==l.elementType&&c.push("element:"+l.elementType);for(n=0;n<l.stylers.length;n++){s=l.stylers[n];for(u in s)d=s[u],"color"===u&&(d="0x"+d.substring(1)),c.push(u+":"+d)}c=c.join("|"),""!==c&&f.push("style="+c)}var v,h,m,y,b,w,S=new r.LatLngBounds;for(e=0;e<t.drawings.length;e++){for(h=[],v=t.drawings[e],m=v._poly.getPath().getArray(),n=0;n<m.length;n++)S.extend(m[n]);y=r.geometry.encoding.encodePath(m),b=o.colors[v.colorIndex],w="0x"+a.convert.rgba(b).to.hex32(),v.fill?(h.push("fillcolor:"+w),h.push("weight:0")):(h.push("color:"+w),h.push("weight:"+b.weight)),h.push("enc:"+y),h=h.join("|"),h&&f.push("path="+h)}var x=S.getNorthEast(),C=S.getSouthWest(),$=r.geometry.spherical.computeHeading,D=Math.abs($(x,C)+$(C,x))/2;return f.push((D>=45&&135>D)==p.ratio>=1?"size="+p.height+"x"+p.width:"size="+p.width+"x"+p.height),f.push("format=jpg"),f.push("scale=2"),f.push("sensor=true"),encodeURI(g+"?"+f.join("&"))}},i.generatePdf=function(e,n,o){o||(o=i.generateUrl()),console.info(o);for(var r,t=[],l=a.colors[Symbol.iterator]();!(r=l.next()).done;){var c=r.value,s={name:c.name,label:c.label,color:"#"+a.convert.rgba(c).to.hex24()};t.push(s)}var u={serif:!0,locality:e,notes:"See attached form for Do Not Calls.\nAdd new Do Not Calls as you find them.",legend:t,number:n,image:o},d=document.createElement("form");d.style="display: none;",d.enctype="x-www-form-urlencoded",d.action="http://boundariesapp.herokuapp.com/pdf",d.method="POST";var g=document.createElement("input");g.name="json",g.type="text",g.value=angular.toJson(u),d.appendChild(g),document.body.appendChild(d),d.submit(),document.body.removeChild(d)}}]).controller("ImageCtrl",["$scope","ImageSvc",function(e,n){e.data={locality:"",number:""},e.downloadPdf=function(){var e=prompt("Locality (for example, the name of the city)","");if(null!==e){var o=prompt("Territory number (for example, MR-1056)","");null!==o&&n.generatePdf(e,o,n.generateUrl())}}}]),angular.module("bndry.map",["ngStorage"]).service("MapSvc",["$rootScope",function(e){function n(n){o.map.addListener(n,function(o){e.$broadcast("map:"+n,o)})}var o=this;angular.extend(o,google.maps),o.map=new o.Map(document.getElementById("map_canvas")),o.placesSvc=new o.places.PlacesService(o.map),o.autocompleteSvc=new o.places.AutocompleteService;var r=["bounds_changed","center_changed","click","dblclick","drag","dragend","dragstart","heading_changed","idle","maptypeid_changed","mousemove","mouseout","mouseover","projection_changed","resize","rightclick","tilesloaded","tilt_changed","zoom_changed"];r.forEach(n)}]).controller("MapCtrl",["$scope","$rootScope","$localStorage","MapSvc",function(e,n,o,r){o.$default({lat:0,lng:0,zoom:10,mapTypeId:r.MapTypeId.ROADMAP,style:[{stylers:[{visibility:"off"}]},{featureType:"landscape",stylers:[{visibility:"on"},{color:"#ffffff"}]},{featureType:"road",stylers:[{visibility:"on"}]},{elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#808080"}]},{elementType:"labels.text.stroke",stylers:[{color:"#ffffff"}]},{elementType:"labels.text.fill",stylers:[{color:"#000000"}]},{featureType:"water",stylers:[{visibility:"on"},{color:"#40bfbf"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#dfdfdf"}]},{featureType:"road.local",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"landscape.man_made",stylers:[{visibility:"off"}]}]}),e.$on("map:idle",function(){var e=r.map.getCenter(),n=r.map.getZoom();o.lat=e.lat(),o.lng=e.lng(),o.zoom=n}),e.$on("map:maptypeid_changed",function(){var e=r.map.getMapTypeId();o.mapTypeId=e});var t={center:new r.LatLng(o.lat,o.lng),disableDefaultUI:!0,disableDoubleClickZoom:!0,draggableCursor:"crosshair",draggingCursor:"move",mapTypeId:o.mapTypeId,zoomControl:!0,zoomControlOptions:{position:r.ControlPosition.LEFT_CENTER},scaleControl:!0,zoom:o.zoom};r.map.setOptions(t);var a=new r.StyledMapType(o.style,{name:"Custom"});r.map.mapTypes.set("custom",a)}]).controller("MapActionCtrl",["$scope","MapSvc",function(e,n){e.mapTypeId=n.MapTypeId,e.setMapTypeId=function(e){n.map.setMapTypeId(e)},e.getMapTypeId=function(){return console.log(n.map.getMapTypeId()),n.map.getMapTypeId()}}]),angular.module("bndry.search",["ngSanitize","bndry.map"]).directive("focusOn",["$parse",function(){return{restrict:"A",link:function(e,n,o){o.$observe("focusOn",function(e){void 0!==e&&(e?n[0].focus():n[0].blur())})}}}]).service("SearchSvc",["$q","MapSvc",function(e,n){this.search=function(o){var r=e.defer();if(o.length<=0)r.resolve([]);else{var t={input:o};t.bounds=n.map.getBounds(),n.autocompleteSvc.getPlacePredictions(t,function(e,o){o===n.places.PlacesServiceStatus.OK?r.resolve(e):r.reject(o===n.places.PlacesServiceStatus.ZERO_RESULTS?"No Results":"An Error Occurred")})}return r.promise},this.loadPlaceFromReference=function(e){e&&e&&n.placesSvc.getDetails({reference:e},function(e,o){o===n.places.PlacesServiceStatus.OK&&(e.geometry.viewport?n.map.fitBounds(e.geometry.viewport):e.geometry.location&&n.map.panTo(e.geometry.location))})}}]).controller("SearchCtrl",["$scope","$sce","$sessionStorage","SearchSvc",function(e,n,o,r){function t(e){return l?(s=e,l=!1,void r.search(e).then(a,i).then(function(){l=!0,"string"==typeof c&&c!==s&&(t(c),c=!1)})):void(c=e)}function a(o){for(var r=0;r<o.length;r++){var t=o[r].description;o[r].description="";for(var a=0,i=0;i<o[r].matched_substrings.length;i++){var l=o[r].matched_substrings[i].offset,c=o[r].matched_substrings[i].length;o[r].description+=t.slice(a,l)+"<b>"+t.substr(l,c)+"</b>",a=l+c}o[r].description+=t.slice(a),o[r].description="<span>"+o[r].description+"</span>",o[r].description=n.trustAsHtml(o[r].description)}e.suggestions=o}function i(o){"string"==typeof o&&(e.suggestions=[{description:n.trustAsHtml("<i>"+o+"</i>"),error:!0}])}var l=!0,c=!1,s="";e.query="",e.active=-1,e.keydown=function(n){var o=13===n.which,r=38===n.which,t=40===n.which;return o||r||t?(n.preventDefault(),void(e.suggestions[e.active]&&(o?(e.loadOnMap(e.suggestions[e.active].reference),e.focus=!1):r&&e.active>-1?e.active--:t&&e.active<e.suggestions.length-1&&e.active++))):void(e.active=0)},e.focus=!1,e.loadOnMap=function(n){r.loadPlaceFromReference(n),e.focus=!1},e.$watch("query",t)}]),angular.module("bndry.shape",["ngStorage"]).service("ShapeSvc",["$localStorage",function(e){this.rigid=function(n){return n?void(e.rigid=n):e.rigid},this.fill=function(n){return n?void(e.fill=n):e.fill}}]).controller("ShapeCtrl",["$scope","$localStorage",function(e,n){e.$storage=n}]).run(["$localStorage",function(e){e.$default({rigid:!1,fill:!1})}]),angular.module("bndry.status",["bndry.map","bndry.geo"]).directive("statusBar",["$interval",function(){return{restrict:"E",scope:{hide:"@",value:"@"},template:'<div ng-style="{width: percentage()}" style="height: 100%; position: absolute;" ng-hide="hide"></div>',link:function(e){var n=0,o=0;e.$on("load:start",function(){n++}),e.$on("load:done",function(){o++,o>=n&&(n=0,o=0)}),e.$on("load:error",function(){n=0,o=0,alert("Directions are not available for this location.")}),e.percentage=function(){return""+(o+1)/(n+1)*100+"%"}}}}]).controller("StatusCtrl",["$scope","$timeout","MapSvc","GeocodeSvc",function(e,n,o,r){var t,a="";e.locality=function(){return a},e.$on("map:idle",function(){t&&o.map.getBounds().equals(t)||r.geocode(o.map.getCenter()).then(function(e){var n=["locality","administrative_area_level_1","country"];if(a="",e.length<1)return void(a="Unknown Locality");for(var o,r=n[Symbol.iterator]();!(o=r.next()).done;)for(var t,i=o.value,l=e[Symbol.iterator]();!(t=l.next()).done;){var c=t.value;if(c.types.indexOf(i)>-1)return console.log("Found "+i+" in result",c),void(a=c.formatted_address)}})})}]),angular.module("bndry",["ngTouch","ngStorage","ui.map","ngAnimate","bndry.action","bndry.color","bndry.drawing","bndry.geo","bndry.history","bndry.image","bndry.map","bndry.shape","bndry.search","bndry.status"]).config(["$compileProvider",function(e){e.debugInfoEnabled(!1)}]).directive("ngXlinkHref",function(){return{priority:99,restrict:"A",link:function(e,n,o){var r="xlink:href";o.$observe("ngXlinkHref",function(e){e&&n.attr(r,e)})}}}).directive("noScroll",function(){return{restrict:"A",link:function(e,n){n.on("touchstart wheel",function(e){e.preventDefault()})}}}).controller("MasterCtrl",["$scope","$localStorage","$sce","ColorSvc","DrawingSvc",function(e,n,o,r,t){e.$storage=n,e.fillActiveColor=function(){var e=r.convert.rgba(r.activeColor()).to.hex24();return"#"+e},e.shouldCreateNewDrawing=t.shouldCreateNewDrawing,e.toggleForceCreateNewDrawing=function(){t.forceCreateNewDrawing=!t.forceCreateNewDrawing},e.sprite=function(){return o.trustAsResourceUrl("#"+(e.$storage.rigid?"rigid":"flex")+"-"+(e.$storage.fill?"fill":"nofill"))},e.show={header:"",footer:""},e.setShowHeader=function(n){e.show.header=e.show.header===n?"":n},e.setShowFooter=function(n){e.show.footer=e.show.footer===n?"":n}}]).run(function(){window.addEventListener("orientationchange",function(){window.scrollTo(0,0)}),FastClick.attach(document.body)});
//# sourceMappingURL=sourcemaps/script.min.js.map