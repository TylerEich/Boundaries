/*
 Boundaries v1.0.0
 (c) 2013-2014 Tyler Eich https://github.com/TylerEich/Boundaries
 License: MIT
*/
"use strict";angular.module("bndry.action",[]).controller("ActionCtrl",["$rootScope","$scope","HistorySvc",function(e,n,r){n.clear=function(){e.$broadcast("action:clear"),r.clear()},n.undo=function(){r.hasUndo()&&r.undo()},n.redo=function(){r.hasRedo()&&r.redo()}}]),angular.module("bndry.color",["ngStorage"]).service("ColorSvc",["$localStorage",function(e){function n(e,n,r,t){return e=Math.round(255*e),n=Math.round(255*n),r=Math.round(255*r),t=Math.round(255*t),(e<<24|n<<16|r<<8|t)>>>0}function r(e,n,r){return 0>r&&(r+=1),r>1&&(r-=1),1/6>r?e+6*(n-e)*r:.5>r?n:2/3>r?e+(n-e)*(2/3-r)*6:e}var t={},o=this;this.convert={rgba:function(e){return t=n(e.r,e.g,e.b,e.a),o},hsla:function(e){var a,i,l,c=e,s=c.h,u=c.s,d=c.l,g=c.a;if(0==u)a=i=l=d;else{var f=.5>d?d*(1+u):d+u-d*u,p=2*d-f;a=r(p,f,s+1/3),i=r(p,f,s),l=r(p,f,s-1/3)}return t=n(a,i,l,g),o},hex24:function(e){return o.convert.hex32(e+"FF"),o},hex32:function(e){return t=parseInt(e,16)>>>0,o}},this.to={rgba:function(){var e=(t>>24&255)/255,n=(t>>16&255)/255,r=(t>>8&255)/255,o=(255&t)/255;return t=0,{r:e,g:n,b:r,a:o}},hsla:function(){var e,n,r=o.to.rgba(),t=r.r,a=r.g,i=r.b,l=r.a,c=Math.max(t,a,i),s=Math.min(t,a,i),u=(c+s)/2;if(c===s)e=n=0;else{var d=c-s;switch(n=u>.5?d/(2-c-s):d/(c+s),c){case t:e=(a-i)/d+(i>a?6:0);break;case a:e=(i-t)/d+2;break;case i:e=(t-a)/d+4}e/=6}return{h:e,s:n,l:u,a:l}},hex24:function(){return o.to.hex32().substring(0,6)},hex32:function(){var e=t.toString(16);return t=0,("00000000"+e).slice(-8)}},delete e.colors,e.$default({colors:[{name:"Red",label:"Do not work either side",r:1,g:0,b:0,a:.125,weight:10},{name:"Green",label:"Work ONLY the inner side",r:0,g:1,b:0,a:.125,weight:10},{name:"Blue",label:"Work both sides",r:0,g:0,b:1,a:.125,weight:10}],activeColorIndex:1}),o.colors=e.colors,o.activeColorIndex=function(){return e.activeColorIndex},o.setActiveColorIndex=function(n){e.activeColorIndex=n},o.activeColor=function(){return o.colors[o.activeColorIndex()]}}]).controller("ColorCtrl",["$scope","$localStorage","ColorSvc",function(e,n,r){e.$storage=n,e.fillColor=function(e){void 0===e&&(e=r.activeColorIndex);var n=r.colors[e];return"#"+r.convert.rgba(n).to.hex24()},e.activeColorIndex=r.activeColorIndex,e.setActiveColorIndex=r.setActiveColorIndex}]),angular.module("bndry.drawing",["ngStorage","bndry.map","bndry.color","bndry.shape","bndry.history"]).service("DirectionsSvc",["$q","MapSvc",function(e,n){var r=this,t=new n.DirectionsService;r.route=function(r){function o(e){t.route(a,function(r,t){if(t===n.DirectionsStatus.OK){var a=r.routes[0].overview_path;i.resolve(a)}else t===n.DirectionsStatus.UNKNOWN_ERROR&&3>e?(e++,o(e)):i.reject()},function(){3>e?(e++,o(e)):i.reject()})}if(2!==r.length)return console.error("Requires exactly 2 locations."),!1;var a={origin:r[0],destination:r[1],travelMode:n.TravelMode.DRIVING},i=e.defer();return o(0),i.promise}}]).service("DrawingSvc",["$rootScope","$q","$localStorage","DirectionsSvc","MapSvc","ColorSvc","ShapeSvc",function(e,n,r,t,o,a,i){function l(e){var n=void 0!==arguments[1]?arguments[1]:0,r=void 0!==arguments[2]?arguments[2]:0,t=void 0!==arguments[3]?arguments[3]:[],o=[n,r].concat(t);return Array.prototype.splice.apply(e,o)}function c(e,n){for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}function s(e){return Array.isArray(e)?e:[e]}function u(e){return console.assert("lat"in e&&"lng"in e&&"number"==typeof e.lat&&"number"==typeof e.lat,"latLng is not formatted properly"),new o.LatLng(e.lat,e.lng)}function d(e,n,r){return l(e,n,0,r)}function g(e,n,r){return l(e,n,r)}function f(e){var r=void 0!==arguments[1]?arguments[1]:!1;console.assert(Array.isArray(e),"locations is not an Array");for(var o=[],a=0;a<e.length-1;a++){var i,l=e[a],c=e[a+1];i=r?n.when(l.equals(c)?[l]:[l,c]):t.route([l,c]),o.push(i)}return n.all(o)}function p(e,n,r){r=s(r);for(var t,a=r[Symbol.iterator]();!(t=a.next()).done;){var i=t.value;i._marker.setMap(o.map)}return l(e,n,0,r)}function v(e,n){for(var r,t=void 0!==arguments[2]?arguments[2]:1,o=l(e,n,t),a=o[Symbol.iterator]();!(r=a.next()).done;){var i=r.value;i._marker.setMap(null)}return o}function h(e,n){console.assert("object"==typeof e&&"object"==typeof n,"Invalid parameters"),c(e,n);for(var r in n)switch(r){case"lat":case"lng":e._marker.setPosition(u(e))}}function m(e,n,r){var t=s(e),o=0,a=0;if(Array.isArray(r))for(a=0;a+n<t.length&&a<r.length;a++)o+=r[a],t[n+a].index+=o;else o=r;for(a+=n;a<t.length;a++)t[a].index+=o}function y(e,n,r){for(var t=s(e),o=n;o<t.length;o++)t[o].index=r}function b(e,n,r){var t=e[n-1],o=0;t&&(o=t.index),y(r,0,o)}function w(e,n,r){var t={start:null,end:null,length:null,nodeStart:null,nodeEnd:null,nodeLength:null,lastNode:!1,firstNode:!1},o=e.slice(n,r),a=o[0],i=o[o.length-1],l=e[n-1],c=e[r];return l||(t.firstNode=!0),l&&null!==l.index?(t.start=l.index,t.nodeStart=n):a&&null!==a.index?(t.start=a.index,t.nodeStart=n+1):(t.start=0,t.nodeStart=0),c||(t.lastNode=!0),c&&null!==c.index?(t.end=c.index,t.nodeEnd=r):i&&null!==i.index?(t.end=i.index,t.nodeEnd=r-1):(t.end=t.start,t.nodeEnd=t.nodeStart),t.nodeLength=t.nodeEnd-t.nodeStart,t.length=t.end-t.start,t}function S(e,n,r,t){var o,a=[],i=e.slice(n,r),l=e[n-1],c=e[r];l&&a.push(u(l));for(var s,d=i[Symbol.iterator]();!(s=d.next()).done;)o=s.value,a.push(u(o));return c&&a.push(u(c)),a.length<2&&a.push(a[0]),f(a,t)}function x(e,n){for(var r,t,o=n[Symbol.iterator]();!(t=o.next()).done;){var a=t.value;r=e[a.index],console.assert(r,"latLng is not defined"),h(a,{lat:r.lat(),lng:r.lng()})}}function C(n,r,t){var o=w(n.nodes,r,r+t);if(0!==t||!o.firstNode||o.lastNode){var a=n._poly.getPath().getArray(),i=o.length;o.lastNode&&i++,g(a,o.start,i),m(n.nodes,o.nodeStart,-o.length);var l=v(n.nodes,r,t);return n._poly.setPath(a),e.$broadcast("drawing:change"),l}}function $(n,r,t,o){for(var a,i,l,c=n._poly.getPath().getArray(),s=n.nodes,u=[],g=w(s,r,r+t.length),f=g.start,p=o[Symbol.iterator]();!(l=p.next()).done;)a=l.value,i=a.pop(),d(c,f,a),f+=a.length,u.push(a.length);var v=o.length;m(s,g.nodeStart,u),g.lastNode&&i&&(c.push(i),v++);var h=s.slice(r,r+v);return x(c,h),n._poly.setPath(c),e.$broadcast("drawing:change"),c}function T(e,r,t){var o=void 0!==arguments[3]?arguments[3]:[],a=void 0!==arguments[4]?arguments[4]:null;return D(function(e,r,t,o,a){var i=C(e,r,t);o=null===o?i:s(o),b(e.nodes,r,o),p(e.nodes,r,o);var l;return l=a?n.when(a):S.bind(null,e.nodes,r,r+o.length,e.rigid)(),l.then(function(e,n,r,t,o){return $(e,n,t,o)}.bind(null,e,r,t,o))}.bind(null,e,r,t,o,a))}function D(){var e=void 0!==arguments[0]?arguments[0]:[];console.assert(void 0!==e,"steps cannot be undefined"),e=s(e);for(var n,r=e[Symbol.iterator]();!(n=r.next()).done;){var t=n.value;F=F.then(t)}return F}function M(e,n){var r,t=void 0!==arguments[2]?arguments[2]:!1;return r=t?new o.Polygon(E(e,t)):new o.Polyline(E(e,t)),{colorIndex:e,rigid:n,fill:t,_poly:r,nodes:[]}}function I(e,n,r){return D(l.bind(null,e,n,0,r))}function k(e,n,r){return D(function(e,n,r){for(var t=l(e,n,r),o=0;o<t.length;o++){var a=t[o];A(a,0,a.nodes.length),a._poly.setMap(null)}}.bind(null,e,n,r))}function N(e,n){var r=void 0!==arguments[2]?arguments[2]:null,t=new o.Marker(O(e,n));return{lat:n.lat(),lng:n.lng(),index:r,_marker:t}}function _(e,n){var r=void 0!==arguments[2]?arguments[2]:[],t=void 0!==arguments[3]?arguments[3]:null;return T(e,n,0,r,t)}function A(e,n,r){var t=void 0!==arguments[3]?arguments[3]:null;return T(e,n,r,[],t)}function P(e,n,r){var t=void 0!==arguments[3]?arguments[3]:null;return D(function(e,n,r){h(e.nodes[n],r)}.bind(null,e,n,r)),T.bind(null,e,n,1,null,t)()}function L(e){var n=a.colors[e];return{path:o.SymbolPath.CIRCLE,scale:10,strokeColor:"#"+a.convert.rgba(n).to.hex24(),strokeOpacity:1,strokeWeight:2.5}}function O(e,n){return{clickable:!0,crossOnDrag:!1,cursor:"pointer",draggable:!0,flat:!0,icon:L(e),map:o.map,position:n}}function E(e,n){var r={clickable:!n,draggable:!1,editable:!1,map:o.map},t=angular.copy(a.colors[e]);return t.a=.5,n?(r.fillColor=z(t),r.fillOpacity=1,r.strokeWeight=0):(r.strokeColor=z(t),r.strokeWeight=t.weight),r}function R(e){var n={type:"FeatureCollection"};return n.features=e.map(function(e){var n={type:"Feature"},r=e._poly.getPath().getArray(),t=r.map(function(e){return[e.lng(),e.lat()]});n.geometry={type:e.fill?"Polygon":"LineString",coordinates:e.fill?[t]:t};var o=e,a=o.colorIndex,i=o.rigid,l=o.fill,c=o.nodes;return n.properties={colorIndex:a,rigid:i,fill:l},n.properties.nodes=c.map(function(e){var n=e,r=n.lat,t=n.lng,o=n.index;return{lat:r,lng:t,index:o}}),n}),JSON.stringify(n)}function j(e){console.assert("string"==typeof e,"geoJson must be a string");var n=[],r=JSON.parse(e),n=r.features.map(function(e,r){var t=e.properties,a=t.colorIndex,i=t.rigid,l=t.fill,c=t.nodes,s=M(a,i,l);I(n,r,s);var u,d=c.map(function(e){var n=new o.LatLng(e.lat,e.lng);return N.bind(null,s.colorIndex,n,e.index)()});u=l?e.geometry.coordinates[0]:e.geometry.coordinates;for(var g=u.map(function(e){return new o.LatLng(e[1],e[0])}),f=[],r=0;r<d.length-1;r++){var p=d[r],v=d[r+1],h=g.slice(p.index,v.index+1);f.push(h)}return console.log(f),_.bind(null,s,0,d,f)(),s});return n}function z(e){return"rgba("+Math.round(255*e.r)+","+Math.round(255*e.g)+","+Math.round(255*e.b)+","+e.a+")"}var q=this,F=n.when();q.queue=D,q.makeDrawing=M,q.addDrawings=q.addDrawing=I,q.removeDrawings=q.removeDrawing=k,q.makeNode=N,q.addNodesToDrawing=q.addNodeToDrawing=_,q.removeNodesFromDrawing=q.removeNodeFromDrawing=A,q.changeNodeOfDrawing=P,q.drawingsToGeoJson=R,q.geoJsonToDrawings=j,q.forceCreateNewDrawing=!1,q.shouldCreateNewDrawing=function(){if(0===q.drawings.length||q.forceCreateNewDrawing)return!0;var e=q.drawings[q.drawings.length-1],n=e&&(e.colorIndex!==a.activeColorIndex()||e.rigid!==i.rigid()||e.fill!==i.fill());return n},q.drawings}]).controller("DrawingCtrl",["$scope","$localStorage","$timeout","DrawingSvc","ColorSvc","ShapeSvc","HistorySvc",function(e,n,r,t,o,a){function i(e,n){var r=o.activeColorIndex(),i=a.rigid(),l=a.fill();if(t.shouldCreateNewDrawing()){var c=t.makeDrawing(r,i,l);f++,t.addDrawing(s,f,c),t.forceCreateNewDrawing=!1}p(function(e,n,r){var o=s[e],a=t.makeNode(n,r);t.addNodeToDrawing(o,o.nodes.length,a)}.bind(null,f,r,n.latLng))}function l(e,n,r){var o=e[0],a=s[n],i=(a.nodes[r],o.latLng);t.changeNodeOfDrawing(a,r,{lat:i.lat(),lng:i.lng()})}e.$storage=n.$default({drawings:[],rigid:!1,colors:[{r:1,g:0,b:0,a:.125,weight:10},{r:0,g:1,b:0,a:.125,weight:10},{r:0,g:0,b:1,a:.125,weight:10}]});for(var c,s=e.drawings=t.drawings=[],u=t.geoJsonToDrawings(localStorage.geoJson||t.drawingsToGeoJson(s)),d=u[Symbol.iterator]();!(c=d.next()).done;){var g=c.value;s.push(g)}var f=s.length-1,p=t.queue;e.$on("map:click",i),e.$on("action:clear",function(){t.removeDrawings(s,0,s.length),f=-1}),e.$on("drawing:change",function(){localStorage.geoJson=t.drawingsToGeoJson(s)}),e.marker={click:function(e){i(void 0,e[0])},dragend:l},e.poly={click:function(e){i(void 0,e[0])}}}]),angular.module("bndry.geo",["bndry.map"]).service("GeolocationSvc",["$q",function(e){this.getLocation=function(){var n=e.defer();return"geolocation"in navigator?navigator.geolocation.getCurrentPosition(function(e){n.resolve(e)},function(e){n.reject(e)}):n.reject(!1),n.promise}}]).service("GeocodeSvc",["$q","MapSvc",function(e,n){this.geocode=function(r){var t=new n.Geocoder,o=e.defer();return t.geocode({location:r},function(e,r){r===n.GeocoderStatus.OK?o.resolve(e):o.reject(r)}),o.promise}}]),angular.module("bndry.history",[]).service("HistorySvc",function(){var e,n,r=[],t=-1,o=!1;return n=function(e,n){return e&&"function"==typeof e[n]?(o=!0,e[n](),o=!1,this):this},{add:function(n){return o?this:(r.splice(t+1,r.length-t),r.push(n),t=r.length-1,e&&e(),this)},setCallback:function(n){e=n},undo:function(){var o=r[t];return o?(n(o,"undo"),t-=1,e&&e(),this):this},redo:function(){var o=r[t+1];return o?(n(o,"redo"),t+=1,e&&e(),this):this},clear:function(){var n=r.length;r=[],t=-1,e&&n>0&&e()},hasUndo:function(){return-1!==t},hasRedo:function(){return t<r.length-1},getCommands:function(){return r}}}),angular.module("bndry.image",["ngStorage","bndry.map","bndry.drawing","bndry.color"]).service("ImageSvc",["$http","$document","$localStorage","MapSvc","DrawingSvc","ColorSvc",function(e,n,r,t,o,a){var i=this;i.pxSize=function(e,n){var r=.7;return{ratio:r,width:r>=1?e:Math.round(r*e),height:1>r?n:Math.round(1/r*n)}},i.generateUrl=function(){if(o.drawings){var e,n,l,c,s,u,d,g="https://maps.googleapis.com/maps/api/staticmap",f=[],p=i.pxSize(640,640);for(e=0;e<r.style.length;e++){l=r.style[e],c=[],"featureType"in l&&"all"!==l.featureType&&c.push("feature:"+l.featureType),"elementType"in l&&"all"!==l.elementType&&c.push("element:"+l.elementType);for(n=0;n<l.stylers.length;n++){s=l.stylers[n];for(u in s)d=s[u],"color"===u&&(d="0x"+d.substring(1)),c.push(u+":"+d)}c=c.join("|"),""!==c&&f.push("style="+c)}var v,h,m,y,b,w,S=new t.LatLngBounds;for(e=0;e<o.drawings.length;e++){for(h=[],v=o.drawings[e],m=v._poly.getPath().getArray(),n=0;n<m.length;n++)S.extend(m[n]);y=t.geometry.encoding.encodePath(m),b=r.colors[v.colorIndex],w="0x"+a.convert.rgba(b).to.hex32(),v.fill?(h.push("fillcolor:"+w),h.push("weight:0")):(h.push("color:"+w),h.push("weight:"+b.weight)),h.push("enc:"+y),h=h.join("|"),h&&f.push("path="+h)}var x=S.getNorthEast(),C=S.getSouthWest(),$=t.geometry.spherical.computeHeading,T=Math.abs($(x,C)+$(C,x))/2;return f.push((T>=45&&135>T)==p.ratio>=1?"size="+p.height+"x"+p.width:"size="+p.width+"x"+p.height),f.push("format=jpg"),f.push("scale=2"),f.push("sensor=true"),encodeURI(g+"?"+f.join("&"))}},i.generatePdf=function(e,n,r){r||(r=i.generateUrl()),console.info(r);for(var t,o=[],l=a.colors[Symbol.iterator]();!(t=l.next()).done;){var c=t.value,s={name:c.name,label:c.label,color:"#"+a.convert.rgba(c).to.hex24()};o.push(s)}var u={serif:!0,locality:e,notes:"See attached form for Do Not Calls.\nAdd new Do Not Calls as you find them.",legend:o,number:n,image:r},d=document.createElement("form");d.style="display: none;",d.enctype="x-www-form-urlencoded",d.action="http://boundariesapp.herokuapp.com/pdf",d.method="POST";var g=document.createElement("input");g.name="json",g.type="text",g.value=angular.toJson(u),d.appendChild(g),document.body.appendChild(d),d.submit(),document.body.removeChild(d)}}]).controller("ImageCtrl",["$scope","ImageSvc",function(e,n){e.locality="",e.number="",e.downloadPdf=function(){var e=prompt("Locality (for example, the name of the city)","");if(null!==e){var r=prompt("Territory number (for example, MR-1056)","");null!==r&&n.generatePdf(e,r,n.generateUrl())}}}]),angular.module("bndry.map",["ngStorage"]).service("MapSvc",["$rootScope",function(e){function n(n){r.map.addListener(n,function(r){e.$broadcast("map:"+n,r)})}var r=this;angular.extend(r,google.maps),r.map=new r.Map(document.getElementById("map_canvas")),r.placesSvc=new r.places.PlacesService(r.map),r.autocompleteSvc=new r.places.AutocompleteService;var t=["bounds_changed","center_changed","click","dblclick","drag","dragend","dragstart","heading_changed","idle","maptypeid_changed","mousemove","mouseout","mouseover","projection_changed","resize","rightclick","tilesloaded","tilt_changed","zoom_changed"];t.forEach(n)}]).controller("MapCtrl",["$scope","$rootScope","$localStorage","MapSvc",function(e,n,r,t){r.$default({lat:0,lng:0,zoom:10,mapTypeId:t.MapTypeId.ROADMAP,style:[{stylers:[{visibility:"off"}]},{featureType:"landscape",stylers:[{visibility:"on"},{color:"#ffffff"}]},{featureType:"road",stylers:[{visibility:"on"}]},{elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#808080"}]},{elementType:"labels.text.stroke",stylers:[{color:"#ffffff"}]},{elementType:"labels.text.fill",stylers:[{color:"#000000"}]},{featureType:"water",stylers:[{visibility:"on"},{color:"#40bfbf"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#dfdfdf"}]},{featureType:"road.local",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"landscape.man_made",stylers:[{visibility:"off"}]}]}),e.$on("map:idle",function(){var e=t.map.getCenter(),n=t.map.getZoom();r.lat=e.lat(),r.lng=e.lng(),r.zoom=n}),e.$on("map:maptypeid_changed",function(){var e=t.map.getMapTypeId();r.mapTypeId=e});var o={center:new t.LatLng(r.lat,r.lng),disableDefaultUI:!0,disableDoubleClickZoom:!0,draggableCursor:"crosshair",draggingCursor:"move",mapTypeId:r.mapTypeId,zoomControl:!0,zoomControlOptions:{position:t.ControlPosition.LEFT_CENTER},scaleControl:!0,zoom:r.zoom};t.map.setOptions(o);var a=new t.StyledMapType(r.style,{name:"Custom"});t.map.mapTypes.set("custom",a)}]).controller("MapActionCtrl",["$scope","MapSvc",function(e,n){e.setMapTypeId=function(e){e in n.MapTypeId&&(console.log(e,"in MapSvc.mapTypeId"),e=n.MapTypeId[e]),n.map.setMapTypeId(e)}}]),angular.module("bndry.search",["ngSanitize","bndry.map"]).directive("focusOn",["$parse",function(e){return{restrict:"A",link:function(n,r,t){var o=e(t.focusOn);n.$watch(o,function(e){void 0!==e&&(e?r[0].focus():r[0].blur())})}}}]).service("SearchSvc",["$q","MapSvc",function(e,n){this.search=function(r){var t=e.defer();if(r.length<=0)t.resolve([]);else{var o={input:r};o.bounds=n.map.getBounds(),n.autocompleteSvc.getPlacePredictions(o,function(e,r){r===n.places.PlacesServiceStatus.OK?t.resolve(e):t.reject(r===n.places.PlacesServiceStatus.ZERO_RESULTS?"No Results":"An Error Occurred")})}return t.promise},this.loadPlaceFromReference=function(e){e&&e&&n.placesSvc.getDetails({reference:e},function(e,r){r===n.places.PlacesServiceStatus.OK&&(e.geometry.viewport?n.map.fitBounds(e.geometry.viewport):e.geometry.location&&n.map.panTo(e.geometry.location))})}}]).controller("SearchCtrl",["$scope","$sce","$sessionStorage","SearchSvc",function(e,n,r,t){function o(e){if(e){if(!l)return void(c=e);s=e,l=!1,t.search(e).then(a,i).then(function(){l=!0,c!==s&&(o(c),c="")})}}function a(r){for(var t=0;t<r.length;t++){var o=r[t].description;r[t].description="";for(var a=0,i=0;i<r[t].matched_substrings.length;i++){var l=r[t].matched_substrings[i].offset,c=r[t].matched_substrings[i].length;r[t].description+=o.slice(a,l)+"<b>"+o.substr(l,c)+"</b>",a=l+c}r[t].description+=o.slice(a),r[t].description="<span>"+r[t].description+"</span>",r[t].description=n.trustAsHtml(r[t].description)}e.suggestions=r}function i(r){"string"==typeof r&&(e.suggestions=[{description:n.trustAsHtml("<i>"+r+"</i>"),error:!0}])}var l=!0,c="",s="";e.$tempStorage=r.$default({query:"",active:-1}),e.keydown=function(n){var r=13===n.which,t=38===n.which,o=40===n.which;return r||t||o?(n.preventDefault(),void(e.suggestions[e.$tempStorage.active]&&(r?(e.loadOnMap(e.suggestions[e.$tempStorage.active].reference),e.show.header=""):t&&e.$tempStorage.active>-1?e.$tempStorage.active--:o&&e.$tempStorage.active<e.suggestions.length-1&&e.$tempStorage.active++))):void(e.$tempStorage.active=0)},e.loadOnMap=t.loadPlaceFromReference,e.$watch("$tempStorage.query",o)}]),angular.module("bndry.shape",["ngStorage"]).service("ShapeSvc",["$localStorage",function(e){this.rigid=function(n){return n?void(e.rigid=n):e.rigid},this.fill=function(n){return n?void(e.fill=n):e.fill}}]).controller("ShapeCtrl",["$scope","$localStorage",function(e,n){e.$storage=n}]).run(["$localStorage",function(e){e.$default({rigid:!1,fill:!1})}]),angular.module("bndry.status",["bndry.map","bndry.geo"]).directive("statusBar",["$interval",function(){return{restrict:"E",scope:{hide:"@",value:"@"},template:'<div ng-style="{width: value * 100 + \'%\'}" style="height: 100%; position: absolute;" ng-hide="hide"></div>',link:function(){}}}]).controller("StatusCtrl",["$scope","$timeout","MapSvc","GeocodeSvc",function(e,n,r,t){var o="";e.locality=function(){return o},e.$on("map:idle",function(){t.geocode(r.map.getCenter()).then(function(e){var n=["administrative_area_level_3","administrative_area_level_2","administrative_area_level_1","country"];o="",e.forEach(function(e){if(!o)for(var r=0;r<n.length;r++)if(e.types.indexOf(n[r])>-1&&(o=e.formatted_address),o)return!1})},function(){o="Unknown Locality"})})}]),angular.module("bndry",["ngTouch","ngStorage","ui.map","ngAnimate","bndry.action","bndry.color","bndry.drawing","bndry.geo","bndry.history","bndry.image","bndry.map","bndry.shape","bndry.search","bndry.status"]).directive("noScroll",function(){return{restrict:"A",link:function(e,n){n.on("touchstart wheel",function(e){e.preventDefault()})}}}).controller("MasterCtrl",["$scope","$localStorage","ColorSvc","DrawingSvc",function(e,n,r,t){e.$storage=n,e.fillActiveColor=function(){var e=r.convert.rgba(r.activeColor()).to.hex24();return"#"+e},e.shouldCreateNewDrawing=t.shouldCreateNewDrawing,e.toggleForceCreateNewDrawing=function(){t.forceCreateNewDrawing=!t.forceCreateNewDrawing},e.show={header:"",footer:""},e.setShowHeader=function(n){e.show.header=e.show.header===n?"":n},e.setShowFooter=function(n){e.show.footer=e.show.footer===n?"":n}}]).run(function(){window.addEventListener("orientationchange",function(){window.scrollTo(0,0)})});
//# sourceMappingURL=sourcemaps/script.min.js.map