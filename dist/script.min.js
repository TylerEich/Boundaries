/*
 Boundaries v1.0.0
 (c) 2013-2014 Tyler Eich https://github.com/TylerEich/Boundaries
 License: MIT
*/
"use strict";angular.module("boundaries.action",[]).controller("ActionCtrl",["$rootScope","$scope",function(e,t){t.clear=e.$broadcast.bind(e,"action:clear")}]),angular.module("boundaries.color",[]).service("ColorSvc",function(){function e(){for(var e=1,t=0,o=arguments.length;o>e;e++)arguments[t]>arguments[e]&&(t=e);return arguments[t]}function t(){for(var e=1,t=0,o=arguments.length;o>e;e++)arguments[e]>arguments[t]&&(t=e);return arguments[t]}function o(e,t,o,r){return e=Math.round(255*e),t=Math.round(255*t),o=Math.round(255*o),r=Math.round(255*r),(e<<24|t<<16|o<<8|r)>>>0}var r={},n=this;this.convert={rgba:function(e){return r=o(e.r,e.g,e.b,e.a),n},hsla:function(e){var t,a=$traceurRuntime.assertObject(e),i=a.h,s=a.s,c=a.l,l=a.a;return i*=6,t=[c+=s*=.5>c?c:1-c,c-i%1*s*2,c-=s*=2,c,c+i%1*s,c+s],r=o(t[~~i%6],t[(16|i)%6],t[(8|i)%6],l),n},hex24:function(e){return n.convert.hex32(e+"FF"),n},hex32:function(e){return r=parseInt(e,16)>>>0,n}},this.to={rgba:function(){var e=(r>>24&255)/255,t=(r>>16&255)/255,o=(r>>8&255)/255,n=(255&r)/255;return r=0,{r:e,g:t,b:o,a:n}},hsla:function(){var o,r,a,i=n.to.rgba(),s=$traceurRuntime.assertObject(i),c=s.r,l=s.g,u=s.b,g=s.a,d=e(c,l,u),p=t(c,l,u),f=p-d;return o=r=a=(p+d)/2,p===d?o=r=0:(o=c===p?(l-u)/f%6:l===p?(u-c)/f+2:(c-l)/f+4,o/=6),{h:o,s:r,l:a,a:g}},hex24:function(){return n.to.hex32().substring(0,6)},hex32:function(){var e=r.toString(16);return r=0,("00000000"+e).slice(-8)}}}).controller("ColorCtrl",["$scope","$localStorage","ColorSvc",function(e,t,o){e.$storage=t.$default({colors:[{r:1,g:0,b:0,a:.125,weight:10},{r:0,g:1,b:0,a:.125,weight:10},{r:0,g:0,b:1,a:.125,weight:10}],activeColor:1}),e.fillColor=function(t){var r=e.$storage.colors[t];return"#"+o.convert.rgba(r).to.hex24()}}]),angular.module("boundaries.drawing",["ngStorage","boundaries.map","boundaries.color"]).service("DirectionsSvc",["$q","MapSvc",function(e,t){var o=this,r=new t.DirectionsService;o.route=function(o){function n(e){r.route(a,function(o,r){if(r===t.DirectionsStatus.OK){var a=o.routes[0].overview_path;i.resolve(a)}else r===t.DirectionsStatus.UNKNOWN_ERROR&&3>e?(e++,n(e)):i.reject()},function(){3>e?(e++,n(e)):i.reject()})}if(2!==o.length)return console.error("Requires exactly 2 locations."),!1;var a={origin:o[0],destination:o[1],travelMode:t.TravelMode.DRIVING},i=e.defer();return n(0),i.promise}}]).service("DrawingSvc",["$rootScope","$q","$localStorage","DirectionsSvc","MapSvc","ColorSvc",function(e,t,o,r,n,a){function i(e){return"rgba("+100*e.r+"%,"+100*e.g+"%,"+100*e.b+"%,"+e.a+")"}function s(e){return{path:n.SymbolPath.CIRCLE,scale:10,strokeColor:"#"+a.convert.rgba(e).to.hex24(),strokeOpacity:1,strokeWeight:2.5}}function c(e,t){return{clickable:!0,crossOnDrag:!1,cursor:"pointer",draggable:!0,flat:!0,icon:s(e),map:n.map,position:t}}function l(e,t){var o={clickable:!0,draggable:!1,editable:!1,map:n.map};return t?(o.fillColor=i(e),o.strokeWeight=0):(o.strokeColor=i(e),o.strokeWeight=e.weight),o}var u=this;u.makePath=function(e,o){var n=t.defer();return o?n.resolve(e):r.route(e).then(n.resolve),n.promise},u.splicePath=function(e,t,o,r){var n=[t,o].concat(r);Array.prototype.splice.apply(e,n)},u.makeNode=function(e,t){var r=o.colors[e],a=new n.Marker(c(r,t));return{lat:t.lat(),lng:t.lng(),index:null,_marker:a}},u.spliceNode=function(e,o,r,a){void 0===r&&(r=u.drawings[e].nodes.length);var i,s,c,l=u.drawings[e];s=l.nodes[o],o>=1&&o-1<l.nodes.length&&(i=l.nodes[o-1]),o>=0&&o+1<l.nodes.length&&(c=l.nodes[o+1]);var g=l.nodes.splice(o,r,a);for(var d in g)g[d]._marker.setMap(null);if(a){var p,f,h,v=[],m=new n.LatLng(a.lat,a.lng);i&&(f=new n.LatLng(i.lat,i.lng),p=u.makePath([f,m],l.rigid).then(function(e){return a.index=i.index+e.length,e}),v.push(p)),c&&(h=new n.LatLng(c.lat,c.lng),v.push(u.makePath([m,h],l.rigid))),i||c||v.push(u.makePath([m,m],l.rigid)),t.all(v).then(function(e){var t,o=Array.prototype.concat.apply([],e),r=l._poly.getPath().getArray(),n=0,g=1;if(i){var d=e.shift();a.index=i.index+d.length,s&&(g+=s.index-i.index),n=i.index,t=d[d.length-1]}else a.index=0;if(c){var p=e[0];s&&(g+=c.index-s.index),c.index=a.index+p.length,t=p[0]}i||c||(t=e[0][0]),u.splicePath(r,n,g,o),a._marker.setPosition(t),l._poly.setPath(r)})}},u.makeDrawing=function(e,t,r){var a,i=o.colors[e];return a=r?new n.Polygon(l(i,r)):new n.Polyline(l(i,r)),{colorIndex:e,rigid:t,fill:r,_poly:a,nodes:[]}},u.spliceDrawing=function(e,t,o){void 0===t&&(t=u.drawings.length),console.log(t,o);var r=u.drawings.slice(e,e+t);for(var n in r)r[n]._poly.setMap(null),u.spliceNode(n,0);Array.prototype.splice.apply(u.drawings,arguments)},u.drawings=[]}]).controller("DrawingCtrl",["$scope","$localStorage","DrawingSvc",function(e,t,o){function r(t,r){var a=e.$storage.activeColor,i=!1,s=!1;if(n()){var c=o.makeDrawing(a,i,s);o.spliceDrawing(o.drawings.length,0,c)}var l=o.drawings.length-1,u=o.drawings[l].nodes.length;o.spliceNode(l,u,0,o.makeNode(a,r.latLng))}function n(){if(0===o.drawings.length)return!0;var t=o.drawings[o.drawings.length-1];return t&&t.colorIndex!==e.$storage.activeColor}e.$storage=t.$default({rigid:!1,colors:[{r:1,g:0,b:0,a:.125,weight:10},{r:0,g:1,b:0,a:.125,weight:10},{r:0,g:0,b:1,a:.125,weight:10}],activeColor:1}),e.drawings=o.drawings,e.$on("map:click",r),e.$on("action:clear",function(){o.spliceDrawing(0)}),e.marker={click:function(e){r(void 0,e[0])},dragend:function(e,t,r){var n=e[0],a=o.drawings[t].colorIndex,i=o.makeNode(a,n.latLng);o.spliceNode(t,r,1,i)}},e.poly={click:function(){}}}]),angular.module("boundaries.geo",["boundaries.map"]).service("GeolocationSvc",["$q",function(e){this.getLocation=function(){var t=e.defer();return"geolocation"in navigator?navigator.geolocation.getCurrentPosition(function(e){t.resolve(e)},function(e){t.reject(e)}):t.reject(!1),t.promise}}]).service("GeocodeSvc",["$q","MapSvc",function(e,t){this.geocode=function(o){var r=new t.Geocoder,n=e.defer();return r.geocode({location:o},function(e,o){o===t.GeocoderStatus.OK?n.resolve(e):n.reject(o)}),n.promise}}]),angular.module("boundaries.image",["ngStorage","boundaries.map","boundaries.drawing","boundaries.color"]).service("ImageSvc",["$localStorage","MapSvc","DrawingSvc","ColorSvc",function(e,t,o,r){this.pxSize=function(t,o){var r=e.width/e.height;return{ratio:r,width:r>=1?t:Math.round(r*t),height:1>r?o:Math.round(1/r*o)}},this.generateUrl=function(){if(o.drawings){var n,a,i,s,c,l,u,g="https://maps.googleapis.com/maps/api/staticmap",d=[],p=this.pxSize(640,640);for(n=0;n<e.style.length;n++){i=e.style[n],s=[],"featureType"in i&&"all"!==i.featureType&&s.push("feature:"+i.featureType),"elementType"in i&&"all"!==i.elementType&&s.push("element:"+i.elementType);for(a=0;a<i.stylers.length;a++){c=i.stylers[a];for(l in c)u=c[l],"color"===l&&(u="0x"+u.substring(1)),s.push(l+":"+u)}s=s.join("|"),""!==s&&d.push("style="+s)}var f,h,v,m,y,b,w=new t.LatLngBounds;for(n=0;n<o.drawings.length;n++){for(h=[],f=o.drawings[n],v=f._poly.getPath().getArray(),a=0;a<v.length;a++)w.extend(v[a]);m=t.geometry.encoding.encodePath(v),y=e.colors[f.activeColor],b="0x"+r.convert.hex24().toHex(y.rgba),f.polygon?h.push("fillcolor:"+b):(h.push("color:"+b),h.push("weight:"+y.weight)),h.push("enc:"+m),h=h.join("|"),h&&d.push("path="+h)}var S=w.getNorthEast(),$=w.getSouthWest(),T=Math.abs(t.computeHeading(S,$)+t.computeHeading(t.southWest,S))/2;return d.push((T>=45&&135>T)==p.ratio>=1?"size="+p.height+"x"+p.width:"size="+p.width+"x"+p.height),d.push("format="+e.format),d.push("scale=2"),d.push("sensor=true"),encodeURI(g+"?"+d.join("&"))}}}]),angular.module("boundaries.map",["ngStorage"]).service("MapSvc",["$rootScope",function(e){function t(t){o.map.addListener(t,function(o){e.$broadcast("map:"+t,o)})}var o=this;angular.extend(o,google.maps),o.map=new o.Map(document.getElementById("map_canvas")),o.placesSvc=new o.places.PlacesService(o.map),o.autocompleteSvc=new o.places.AutocompleteService;var r=["bounds_changed","center_changed","click","dblclick","drag","dragend","dragstart","heading_changed","idle","maptypeid_changed","mousemove","mouseout","mouseover","projection_changed","resize","rightclick","tilesloaded","tilt_changed","zoom_changed"];r.forEach(t)}]).controller("MapCtrl",["$scope","$rootScope","$localStorage","MapSvc",function(e,t,o,r){o.$default({lat:0,lng:0,zoom:10,mapTypeId:r.MapTypeId.ROADMAP,style:[{stylers:[{visibility:"off"}]},{featureType:"landscape",stylers:[{visibility:"on"},{color:"#ffffff"}]},{featureType:"road",stylers:[{visibility:"on"}]},{elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#808080"}]},{elementType:"labels.text.stroke",stylers:[{color:"#ffffff"}]},{elementType:"labels.text.fill",stylers:[{color:"#000000"}]},{featureType:"water",stylers:[{visibility:"on"},{color:"#40bfbf"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#dfdfdf"}]},{featureType:"road.local",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"landscape.man_made",stylers:[{visibility:"off"}]}]}),e.$on("map:idle",function(){var e=r.map.getCenter(),t=r.map.getZoom();o.lat=e.lat(),o.lng=e.lng(),o.zoom=t}),e.$on("map:maptypeid_changed",function(){var e=r.map.getMapTypeId();o.mapTypeId=e});var n={center:new r.LatLng(o.lat,o.lng),disableDefaultUI:!0,disableDoubleClickZoom:!0,draggableCursor:"crosshair",draggingCursor:"move",mapTypeId:o.mapTypeId,mapTypeControl:!0,mapTypeControlOptions:{mapTypeIds:[r.MapTypeId.ROADMAP,r.MapTypeId.HYBRID,"custom"]},scaleControl:!0,zoom:o.zoom};r.map.setOptions(n);var a=new r.StyledMapType(o.style,{name:"Custom"});r.map.mapTypes.set("custom",a)}]).controller("MapActionCtrl",["$scope","MapSvc",function(e,t){e.setMapTypeId=function(e){e in t.MapTypeId&&(console.log(e,"in MapSvc.mapTypeId"),e=t.MapTypeId[e]),t.map.setMapTypeId(e)}}]),angular.module("boundaries.mode",[]).controller("ModeCtrl",["$scope",function(e){e.rigid=!1,e.polygon=!1}]),angular.module("boundaries.search",["ngSanitize","boundaries.map"]).directive("focusOn",["$parse",function(e){return{restrict:"A",link:function(t,o,r){var n=e(r.focusOn);t.$watch(n,function(e){void 0!==e&&(e?o[0].focus():o[0].blur())})}}}]).service("SearchSvc",["$q","MapSvc",function(e,t){this.search=function(o){var r=e.defer();if(o.length<=0)r.resolve([]);else{var n={input:o};n.bounds=t.map.getBounds(),t.autocompleteSvc.getPlacePredictions(n,function(e,o){o===t.places.PlacesServiceStatus.OK?r.resolve(e):r.reject(o===t.places.PlacesServiceStatus.ZERO_RESULTS?"No Results":"An Error Occurred")})}return r.promise},this.loadPlaceFromReference=function(e){e&&e&&t.placesSvc.getDetails({reference:e},function(e,o){o===t.places.PlacesServiceStatus.OK&&(e.geometry.viewport?t.map.fitBounds(e.geometry.viewport):e.geometry.location&&t.map.panTo(e.geometry.location))})}}]).controller("SearchCtrl",["$scope","$sce","$sessionStorage","SearchSvc",function(e,t,o,r){function n(e){if(e){if(!s)return void(c=e);l=e,s=!1,r.search(e).then(a,i).then(function(){s=!0,c!==l&&(n(c),c="")})}}function a(o){for(var r=0;r<o.length;r++){var n=o[r].description;o[r].description="";for(var a=0,i=0;i<o[r].matched_substrings.length;i++){var s=o[r].matched_substrings[i].offset,c=o[r].matched_substrings[i].length;o[r].description+=n.slice(a,s)+"<b>"+n.substr(s,c)+"</b>",a=s+c}o[r].description+=n.slice(a),o[r].description="<span>"+o[r].description+"</span>",o[r].description=t.trustAsHtml(o[r].description)}e.suggestions=o}function i(o){"string"==typeof o&&(e.suggestions=[{description:t.trustAsHtml("<i>"+o+"</i>"),error:!0}])}var s=!0,c="",l="";e.$tempStorage=o.$default({query:"",active:-1}),e.keydown=function(t){var o=13===t.which,r=38===t.which,n=40===t.which;return o||r||n?(t.preventDefault(),void(e.suggestions[e.$tempStorage.active]&&(o?(e.loadOnMap(e.suggestions[e.$tempStorage.active].reference),e.show.value=""):r&&e.$tempStorage.active>-1?e.$tempStorage.active--:n&&e.$tempStorage.active<e.suggestions.length-1&&e.$tempStorage.active++))):void(e.$tempStorage.active=0)},e.loadOnMap=r.loadPlaceFromReference,e.$watch("$tempStorage.query",n)}]),angular.module("boundaries.status",["boundaries.map","boundaries.geo"]).directive("statusBar",["$interval",function(e){return{restrict:"E",scope:{hide:"@",value:"@"},template:'<div ng-style="{width: value * 100 + \'%\'}" style="height: 100%; position: absolute;" ng-hide="hide"></div>',link:function(t){e(function(){t.value=Math.random()},1e3)}}}]).controller("StatusCtrl",["$scope","$timeout","MapSvc","GeocodeSvc",function(e,t,o,r){var n="";e.locality=function(){return n},e.$on("map:idle",function(){r.geocode(o.map.getCenter()).then(function(e){var t=["administrative_area_level_3","administrative_area_level_2","administrative_area_level_1","country"];n="",e.forEach(function(e){if(!n)for(var o=0;o<t.length;o++)if(e.types.indexOf(t[o])>-1&&(n=e.formatted_address),n)return!1})},function(){n="Unknown Locality"})})}]),angular.module("boundaries",["ngStorage","ui.map","ngAnimate","boundaries.action","boundaries.color","boundaries.drawing","boundaries.geo","boundaries.image","boundaries.map","boundaries.mode","boundaries.search","boundaries.status"]).directive("noScroll",function(){return{restrict:"A",link:function(e,t){t.on("touchstart wheel",function(e){e.preventDefault()})}}}).controller("MasterCtrl",["$scope","$localStorage","ColorSvc",function(e,t,o){e.$storage=t,e.fillActiveColor=function(){var t=e.$storage.activeColor,r=e.$storage.colors[t],n=o.convert.rgba(r).to.hex24();return"#"+n},e.show={header:"",footer:""},e.setShowHeader=function(t){e.show.header=e.show.header===t?"":t},e.setShowFooter=function(t){e.show.footer=e.show.footer===t?"":t}}]).run(function(){window.addEventListener("DOMContentLoaded",function(){FastClick.attach(document.body),angular.element(document.querySelector("#splash")).removeClass("loading")},!1),window.addEventListener("orientationchange",function(){window.scrollTo(0,0)})});